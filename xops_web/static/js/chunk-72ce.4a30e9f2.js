(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-72ce"],{"41Be":function(e,t,o){"use strict";o.d(t,"a",function(){return i});var s=o("Q2AE");function i(e){if(e&&e instanceof Array&&e.length>0){var t=e;return!!(s.a.getters&&s.a.getters.roles).some(function(e){return t.includes(e)})}return console.error("need roles! Like v-permission=\"['admin','editor']\""),!1}},JNL0:function(e,t,o){"use strict";o.d(t,"a",function(){return i}),o.d(t,"d",function(){return r}),o.d(t,"b",function(){return n}),o.d(t,"c",function(){return a});var s=o("t3Un");function i(e){return Object(s.a)({url:"api/projects/",method:"post",data:e})}function r(e){return Object(s.a)({url:"api/projects/"+e+"/",method:"get"})}function n(e){return Object(s.a)({url:"api/projects/"+e+"/",method:"delete"})}function a(e,t){return Object(s.a)({url:"api/projects/"+e+"/",method:"put",data:t})}},"Tl+i":function(e,t,o){},Yfch:function(e,t,o){"use strict";function s(e){return/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/.test(e)}function i(e){return/^1[3|4|5|7|8][0-9]\d{8}$/.test(e)}function r(e){return/^[a-zA-Z0-9_]+$/g.test(e)}o.d(t,"c",function(){return s}),o.d(t,"b",function(){return i}),o.d(t,"a",function(){return r})},flWt:function(e,t,o){"use strict";var s=o("Tl+i");o.n(s).a},qpgI:function(e,t,o){"use strict";o.d(t,"c",function(){return i}),o.d(t,"d",function(){return r}),o.d(t,"a",function(){return n}),o.d(t,"b",function(){return a});var s=o("t3Un");function i(e){return e?Object(s.a)({url:"api/device/list/?os_type="+e,method:"get"}):Object(s.a)({url:"api/device/list/",method:"get"})}function r(e){return Object(s.a)({url:"api/devices/"+e+"/",method:"get"})}function n(e){return Object(s.a)({url:"api/devices/"+e+"/",method:"delete"})}function a(e,t){return Object(s.a)({url:"api/devices/"+e+"/",method:"put",data:t})}},twU4:function(e,t,o){"use strict";o.d(t,"d",function(){return i}),o.d(t,"a",function(){return r}),o.d(t,"b",function(){return n}),o.d(t,"c",function(){return a}),o.d(t,"e",function(){return l});var s=o("t3Un");function i(){return Object(s.a)({url:"api/dict/tree/",method:"get"})}function r(e){return Object(s.a)({url:"api/dicts/",method:"post",data:e})}function n(e){return Object(s.a)({url:"api/dicts/"+e+"/",method:"delete"})}function a(e,t){return Object(s.a)({url:"api/dicts/"+e+"/",method:"put",data:t})}function l(){for(var e=arguments.length,t=Array(e),o=0;o<e;o++)t[o]=arguments[o];return Object(s.a)({url:"api/dicts/?&key="+t,method:"get"})}},yGhc:function(e,t,o){"use strict";o.r(t);var s=o("41Be"),i=o("j5TT"),r=(o("p77/"),o("enqM"),o("9rZZ"),o("m3Q/"),o("AvDn"),{name:"Sticky",props:{stickyTop:{type:Number,default:0},zIndex:{type:Number,default:1},className:{type:String,default:""}},data:function(){return{active:!1,position:"",width:void 0,height:void 0,isSticky:!1}},mounted:function(){this.height=this.$el.getBoundingClientRect().height,window.addEventListener("scroll",this.handleScroll),window.addEventListener("resize",this.handleReize)},activated:function(){this.handleScroll()},destroyed:function(){window.removeEventListener("scroll",this.handleScroll),window.removeEventListener("resize",this.handleReize)},methods:{sticky:function(){this.active||(this.position="fixed",this.active=!0,this.width=this.width+"px",this.isSticky=!0)},handleReset:function(){this.active&&this.reset()},reset:function(){this.position="",this.width="auto",this.active=!1,this.isSticky=!1},handleScroll:function(){var e=this.$el.getBoundingClientRect().width;this.width=e||"auto",this.$el.getBoundingClientRect().top<this.stickyTop?this.sticky():this.handleReset()},handleReize:function(){this.isSticky&&(this.width=this.$el.getBoundingClientRect().width+"px")}}}),n=o("KHd+"),a=Object(n.a)(r,function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{style:{height:e.height+"px",zIndex:e.zIndex}},[o("div",{class:e.className,style:{top:e.stickyTop+"px",zIndex:e.zIndex,position:e.position,width:e.width,height:e.height+"px"}},[e._t("default",[o("div",[e._v("sticky")])])],2)])},[],!1,null,null,null);a.options.__file="index.vue";var l=a.exports,c=o("twU4"),d=o("qpgI"),u=o("JNL0"),p=o("Yfch"),f=function(e,t,o){t?Object(p.a)(t)?o():o(new Error("不能输入中文")):o(new Error("请输入项目英文名称"))},m={components:{codemirror:i.codemirror,Sticky:l},data:function(){return{is_Readonly:!0,cmOptions:{tabSize:4,styleActiveLine:!0,lineNumbers:!0,line:!0,mode:"text/x-sh",lineWrapping:!0,theme:"monokai",readOnly:!0},transfer_name:["可选服务器","目标服务器"],transfer_data:[],loading:!1,button:"edit",form:{name:"",environment:"",excludes:"",is_include:"false",target_root:"",target_releases:"",task_envs:"",prev_deploy:"",post_deploy:"",prev_release:"",post_release:"",server_ids:"",version_num:10,repo_url:"",repo_mode:""},serverIds:[],env_types:[],repo_modes:[],rules:{name:[{required:!0,message:"请输入项目名称",trigger:"blur"}],alias:[{required:!0,trigger:"blur",validator:f}],environment:[{required:!0,message:"请选择环境",trigger:"blur"}],repo_mode:[{required:!0,message:"请选择模式",trigger:"blur"}],repo_url:[{required:!0,message:"请输入repo url",trigger:"blur"}]}}},created:function(){var e=this;Object(c.e)("ENVIRONMENT_TYPE","REPO_TYPE").then(function(t){e.env_types=t[0].ENVIRONMENT_TYPE.filter(function(e){return"all"!==e.key}),e.repo_modes=t[1].REPO_TYPE}),Object(d.c)("Linux").then(function(t){e.transfer_data=t}),"/deploy/projects/detail"===this.$route.path?this.$nextTick(function(){e.init()}):(this.button="save",this.is_Readonly=!1,this.cmOptions.readOnly=!1)},methods:{checkPermission:s.a,init:function(){var e=this;Object(u.d)(this.$route.query.id).then(function(t){t.is_include=t.is_include.toString(),e.form=t,e.serverIds=e.form.server_ids.split(",")})},filterMethod:function(e,t){return t.label.indexOf(e)>-1},closeTag:function(){this.$store.dispatch("delView",this.$store.state.tagsView.visitedViews.slice(-1)[0]),this.$router.go(-1)},cancel:function(){this.button="edit",this.is_Readonly=!0,this.cmOptions.readOnly=!0},edit:function(){this.button="save",this.is_Readonly=!1,this.cmOptions.readOnly=!1},doSubmit:function(){var e=this;this.$refs.form.validate(function(t){t&&(e.loading=!0,e.form.server_ids=e.serverIds.filter(function(e){return e}).toString(),"/deploy/projects/detail"===e.$route.path?Object(u.c)(e.form.id,e.form).then(function(t){e.resetForm(),e.$message({showClose:!0,type:"success",message:"修改成功!",duration:2500}),e.loading=!1,e.cmOptions.readOnly=!0,e.button="edit",e.init()}).catch(function(t){e.loading=!1,console.log(t.response.data.detail)}):Object(u.a)(e.form).then(function(t){e.resetForm(),e.$message({showClose:!0,type:"success",message:"添加成功!",duration:2500}),e.loading=!1,e.closeTag()}).catch(function(t){e.loading=!1,console.log(t.response.data.detail)}))})},resetForm:function(){this.$refs.form.resetFields(),this.form={name:"",environment:"",excludes:"",is_include:"false",target_root:"",target_releases:"",task_envs:"",prev_deploy:"",post_deploy:"",prev_release:"",post_release:"",server_ids:"",version_num:10,repo_url:"",repo_mode:""}}}},_=(o("flWt"),Object(n.a)(m,function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"formpage"},[o("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-position":"top",size:"small"}},[o("sticky",[o("el-form-item",[o("div",{staticStyle:{display:"inline-block",margin:"0px 0px",float:"right"}},[e.checkPermission(["admin","project_all","project_edit"])&&"edit"==e.button&&"/deploy/projects/detail"===e.$route.path?o("el-button",{attrs:{type:"primary"},on:{click:e.edit}},[e._v("编辑")]):e._e(),e._v(" "),e.checkPermission(["admin","project_all","project_edit"])&&"save"==e.button&&"/deploy/projects/detail"===e.$route.path?o("el-button",{attrs:{type:"success"},on:{click:e.doSubmit}},[e._v("保存")]):e._e(),e._v(" "),e.checkPermission(["admin","project_all","project_edit"])&&"save"==e.button&&"/deploy/projects/detail"===e.$route.path?o("el-button",{attrs:{type:"warning"},on:{click:e.cancel}},[e._v("取消")]):e._e(),e._v(" "),e.checkPermission(["admin","project_all","project_edit"])&&"edit"==e.button&&"/deploy/projects/detail"===e.$route.path?o("el-button",{on:{click:e.closeTag}},[e._v("返回")]):e._e(),e._v(" "),e.checkPermission(["admin","project_all","project_create"])&&"save"==e.button&&"/deploy/projects/create"===e.$route.path?o("el-button",{attrs:{type:"success"},on:{click:e.doSubmit}},[e._v("保存")]):e._e(),e._v(" "),e.checkPermission(["admin","project_all","project_create"])&&"save"==e.button&&"/deploy/projects/create"===e.$route.path?o("el-button",{on:{click:e.closeTag}},[e._v("返回")]):e._e()],1)])],1),e._v(" "),o("p",{staticClass:"warn-content"},[e._v("基础配置")]),e._v(" "),o("el-card",{staticClass:"box-card"},[o("el-row",[o("el-col",{attrs:{span:12}},[o("el-form-item",{attrs:{label:"项目名称",prop:"name"}},[o("el-input",{staticStyle:{width:"300px"},attrs:{readonly:e.is_Readonly},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"项目别名",prop:"alias"}},[o("el-input",{staticStyle:{width:"300px"},attrs:{readonly:e.is_Readonly},model:{value:e.form.alias,callback:function(t){e.$set(e.form,"alias",t)},expression:"form.alias"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"环境",prop:"environment"}},[o("el-select",{staticStyle:{width:"300px"},attrs:{disabled:e.is_Readonly,placeholder:"请选择认证类型"},model:{value:e.form.environment,callback:function(t){e.$set(e.form,"environment",t)},expression:"form.environment"}},e._l(e.env_types,function(e){return o("el-option",{key:e.key,attrs:{label:e.value,value:e.key}})}))],1)],1),e._v(" "),o("el-col",{attrs:{span:12}},[o("el-form-item",{attrs:{label:"Git Repo",prop:"repo_url"}},[o("el-input",{staticStyle:{width:"300px"},attrs:{readonly:e.is_Readonly},model:{value:e.form.repo_url,callback:function(t){e.$set(e.form,"repo_url",t)},expression:"form.repo_url"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"分支/tag",prop:"repo_mode"}},[o("el-select",{staticStyle:{width:"300px"},attrs:{disabled:e.is_Readonly,placeholder:"请选择认证类型"},model:{value:e.form.repo_mode,callback:function(t){e.$set(e.form,"repo_mode",t)},expression:"form.repo_mode"}},e._l(e.repo_modes,function(e){return o("el-option",{key:e.key,attrs:{label:e.value,value:e.key}})}))],1)],1)],1)],1),e._v(" "),o("p",{staticClass:"warn-content"},[e._v("服务器配置")]),e._v(" "),o("el-card",{staticClass:"box-card"},[o("el-form-item",[o("el-transfer",{attrs:{"filter-method":e.filterMethod,data:e.transfer_data,titles:e.transfer_name,filterable:"","filter-placeholder":"请输入IP地址"},model:{value:e.serverIds,callback:function(t){e.serverIds=t},expression:"serverIds"}})],1),e._v(" "),o("el-row",[o("el-col",{attrs:{span:9}},[o("el-form-item",[o("span",{staticClass:"x-info"},[e._v("目标服务器部署（WEB）路径"),o("i",{staticClass:"el-icon-info"})]),e._v(" "),o("el-input",{staticStyle:{width:"300px"},attrs:{readonly:e.is_Readonly},model:{value:e.form.target_root,callback:function(t){e.$set(e.form,"target_root",t)},expression:"form.target_root"}})],1)],1),e._v(" "),o("el-col",{attrs:{span:9}},[o("el-form-item",[o("span",{staticClass:"x-info"},[e._v("目标服务器RELEASE路径（版本仓库）"),o("i",{staticClass:"el-icon-info"})]),e._v(" "),o("el-input",{staticStyle:{width:"300px"},attrs:{readonly:e.is_Readonly},model:{value:e.form.target_releases,callback:function(t){e.$set(e.form,"target_releases",t)},expression:"form.target_releases"}})],1)],1),e._v(" "),o("el-col",{attrs:{span:6}},[o("el-form-item",[o("span",{staticClass:"x-info"},[e._v("仓库版本保留数"),o("i",{staticClass:"el-icon-info"})]),e._v(" "),o("el-input",{staticStyle:{width:"200px"},attrs:{readonly:e.is_Readonly},model:{value:e.form.version_num,callback:function(t){e.$set(e.form,"version_num",t)},expression:"form.version_num"}})],1)],1)],1)],1),e._v(" "),o("p",{staticClass:"warn-content"},[e._v("任务配置")]),e._v(" "),o("el-card",{staticClass:"box-card"},[o("el-row",[o("el-col",{attrs:{span:12}},[o("el-form-item",[o("span",{staticClass:"x-info"},[e._v("排除的文件"),o("i",{staticClass:"el-icon-info"})]),e._v(" "),o("el-radio",{attrs:{label:"false"},model:{value:e.form.is_include,callback:function(t){e.$set(e.form,"is_include",t)},expression:"form.is_include"}},[e._v("排除")]),e._v(" "),o("el-radio",{attrs:{label:"true"},model:{value:e.form.is_include,callback:function(t){e.$set(e.form,"is_include",t)},expression:"form.is_include"}},[e._v("包含")]),e._v(" "),o("codemirror",{staticClass:"x-code",attrs:{options:e.cmOptions},model:{value:e.form.excludes,callback:function(t){e.$set(e.form,"excludes",t)},expression:"form.excludes"}})],1)],1),e._v(" "),o("el-col",{attrs:{span:12}},[o("el-form-item",[o("el-tooltip",{staticClass:"item",attrs:{effect:"dark",placement:"top"}},[o("div",{attrs:{slot:"content"},slot:"content"},[e._v("目标路径：{WEB_ROOT}"),o("br"),e._v("代码路径：{CODE_ROOT}"),o("br"),e._v("项目别名：{ALIAS}"),o("br"),e._v("执行时间：{START_TIME}"),o("br"),o("span",{staticStyle:{color:"#ff9955"}},[e._v("其他变量可自定义")])]),e._v(" "),o("span",{staticClass:"x-info"},[e._v("全局变量"),o("i",{staticClass:"el-icon-info"})])]),e._v(" "),o("codemirror",{staticClass:"x-code",attrs:{options:e.cmOptions},model:{value:e.form.task_envs,callback:function(t){e.$set(e.form,"task_envs",t)},expression:"form.task_envs"}})],1)],1)],1),e._v(" "),o("el-row",[o("el-col",{attrs:{span:12}},[o("el-form-item",[o("span",{staticClass:"x-info"},[e._v("Deploy前置任务"),o("i",{staticClass:"el-icon-info"})]),e._v(" "),o("codemirror",{staticClass:"x-code",attrs:{options:e.cmOptions},model:{value:e.form.prev_deploy,callback:function(t){e.$set(e.form,"prev_deploy",t)},expression:"form.prev_deploy"}})],1)],1),e._v(" "),o("el-col",{attrs:{span:12}},[o("el-form-item",[o("span",{staticClass:"x-info"},[e._v("Deploy后置任务"),o("i",{staticClass:"el-icon-info"})]),e._v(" "),o("codemirror",{staticClass:"x-code",attrs:{options:e.cmOptions},model:{value:e.form.post_deploy,callback:function(t){e.$set(e.form,"post_deploy",t)},expression:"form.post_deploy"}})],1)],1)],1),e._v(" "),o("el-row",[o("el-col",{attrs:{span:12}},[o("el-form-item",[o("span",{staticClass:"x-info"},[e._v("Release前置任务"),o("i",{staticClass:"el-icon-info"})]),e._v(" "),o("codemirror",{staticClass:"x-code",attrs:{options:e.cmOptions},model:{value:e.form.prev_release,callback:function(t){e.$set(e.form,"prev_release",t)},expression:"form.prev_release"}})],1)],1),e._v(" "),o("el-col",{attrs:{span:12}},[o("el-form-item",[o("span",{staticClass:"x-info"},[e._v("Release后置任务"),o("i",{staticClass:"el-icon-info"})]),e._v(" "),o("codemirror",{staticClass:"x-code",attrs:{options:e.cmOptions},model:{value:e.form.post_release,callback:function(t){e.$set(e.form,"post_release",t)},expression:"form.post_release"}})],1)],1)],1)],1),e._v(" "),o("p",{staticClass:"warn-content"},[e._v("工具配置")]),e._v(" "),o("el-card",{staticClass:"box-card"},[o("el-row",[o("el-col",{attrs:{span:9}},[o("el-form-item",[o("span",{staticClass:"x-info"},[e._v("项目启动脚本路径+文件名"),o("i",{staticClass:"el-icon-info"})]),e._v(" "),o("el-input",{staticStyle:{width:"300px"},attrs:{readonly:e.is_Readonly},model:{value:e.form.app_start,callback:function(t){e.$set(e.form,"app_start",t)},expression:"form.app_start"}})],1)],1),e._v(" "),o("el-col",{attrs:{span:9}},[o("el-form-item",[o("span",{staticClass:"x-info"},[e._v("项目停止脚本路径+文件名"),o("i",{staticClass:"el-icon-info"})]),e._v(" "),o("el-input",{staticStyle:{width:"300px"},attrs:{readonly:e.is_Readonly},model:{value:e.form.app_stop,callback:function(t){e.$set(e.form,"app_stop",t)},expression:"form.app_stop"}})],1)],1),e._v(" "),o("el-col",{attrs:{span:6}},[o("el-form-item",[o("span",{staticClass:"x-info"},[e._v("项目日志文件路径"),o("i",{staticClass:"el-icon-info"})]),e._v(" "),o("el-input",{staticStyle:{width:"200px"},attrs:{readonly:e.is_Readonly},model:{value:e.form.app_log_file,callback:function(t){e.$set(e.form,"app_log_file",t)},expression:"form.app_log_file"}})],1)],1)],1)],1)],1)],1)},[],!1,null,"20c2e84e",null));_.options.__file="form.vue";t.default=_.exports}}]);